---
title: "EVD Model"
author: "Shakira Babirye"
date: "2024-09-30"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```





# Load the necessary libraries

```{r}

library(deSolve)
library(ggplot2)
library(reshape2)
library(MASS)
library(readxl)
library(dplyr)
library(lubridate)
library(tidyr)



```






# Loading the dataset

```{r}

cases <- read_excel("C:/Users/bbrsh/Desktop/Shakira/Shakira/EVD Mathematical model/Data/2022-12-06-0600_EVDlinelist.xlsx", 
                    sheet = "Confirmed and probable")


```


# Selected variables that are needed

```{r}

cases_2 = cases %>% 
          dplyr::select(CASE_ID,`Laboratory results for EVD`,`Date of confirmation`,
                        `Date of death`) %>%
          filter(`Laboratory results for EVD`=="Positive" & !is.na(`Date of death`))


print(cases_2)

```




```{r}

# Ensure that 'Date of death' is in POSIXct format (if not already)
cases_2 <- cases_2 %>%
  mutate(`Date of death` = as.POSIXct(`Date of death`))

# Create a new column for the week (starting from the date of death)
cases_2 <- cases_2 %>%
  arrange(`Date of death`) %>%
  mutate(Week = floor_date(`Date of death`, unit = "week"))

# Count the number of deaths per week
deaths_per_week <- cases_2 %>%
  group_by(Week) %>%
  summarise(Deaths = n())

# Print the number of deaths per week
print(deaths_per_week)


```


```{r}

deaths_per_week2<-deaths_per_week$Deaths #Extract the weekly death counts
deaths_per_week2


```




```{r}
dir.create("plots", showWarnings = FALSE)

```


# We are going to start with the simplest model and we shall keep building onto that.

# Simple model (SIR Model)

```{r}


# Define base parameters
base_params <- c(
  beta = 0.5,               # Transmission rate
  delta = 0.05             # Recovery rate
  
)



# Define initial state
initial_state <- c(
  S = 1000,    # Susceptible
  I = 10,
  R = 0
  
)

# Define the time sequence for 150 weeks
times <- seq(1, 150, by = 1)

# Define the model function
EVD_model <- function(time, state, parms) {
  with(as.list(c(state, parms)), {
    N <- S + I + R
    
    dS <- -beta * S * I/N 
    dI <- beta * S * I/N - delta * I
    dR <- delta * I 

    return(list(c(dS, dI, dR)))
  })
}

# Run the simulation
simulation <- ode(y = initial_state, times = times, func = EVD_model, parms = base_params)
output <- as.data.frame(simulation)
colnames(output) <- c("time", "Susceptible", "Infected","Recovered")

output


# Plot the results
plot1 <- ggplot(data = output, aes(x = time)) +
  geom_line(aes(y = Susceptible, color = "Susceptible"), size = 1) +
  geom_line(aes(y = Infected, color = "Infected"), size = 1) +
  geom_line(aes(y = Recovered, color = "Recovered"), size = 1) +
  
  labs(title = "SIR Model Simulation", x = "Time (weeks)", y = "Population") +
  scale_color_manual("", 
                     breaks = c("Susceptible","Infected", "Recovered"),
                     values = c("blue", "red", "purple")) +
  theme_minimal() +
  theme(legend.position = "bottom")

plot1



```




# Next SEIR


```{r}

# Define base parameters
base_params <- c(
  beta = 0.5,               # Transmission rate
  gamma = 1/2,              # Conversion from exposed to infectious
  delta = 0.05             # Recovery rate
  
)



# Define initial state
initial_state <- c(
  S = 1000,    # Susceptible
  E = 20,
  I = 10,
  R = 0
  
)

# Define the time sequence for 150 weeks
times <- seq(1, 150, by = 1)

# Define the model function
EVD_model <- function(time, state, parms) {
  with(as.list(c(state, parms)), {
    N <- S + E + I + R
    
    dS <- -beta * S * I/N 
    dE <- beta * S * I/N - gamma*E
    dI <- gamma*E - delta * I
    dR <- delta * I 

    return(list(c(dS,dE, dI, dR)))
  })
}

# Run the simulation
simulation <- ode(y = initial_state, times = times, func = EVD_model, parms = base_params)
output <- as.data.frame(simulation)
colnames(output) <- c("time", "Susceptible", "Exposed","Infected","Recovered")

output


# Plot the results
plot1 <- ggplot(data = output, aes(x = time)) +
  geom_line(aes(y = Susceptible, color = "Susceptible"), size = 1) +
  geom_line(aes(y = Exposed, color = "Exposed"), size = 1) +
  geom_line(aes(y = Infected, color = "Infected"), size = 1) +
  geom_line(aes(y = Recovered, color = "Recovered"), size = 1) +
  
  labs(title = "SIR Model Simulation", x = "Time (weeks)", y = "Population") +
  scale_color_manual("", 
                     breaks = c("Susceptible","Exposed","Infected", "Recovered"),
                     values = c("blue", "brown","red", "purple")) +
  theme_minimal() +
  theme(legend.position = "bottom")

plot1



```



# SEIRD Model

```{r}

# Define base parameters
base_params <- c(
  beta = 0.5,               # Transmission rate
  gamma = 1/2,              # Conversion from exposed to infectious
  delta = 0.05,             # Recovery rate
  tau = 0.4                 # Death rate
  
)



# Define initial state
initial_state <- c(
  S = 1000,    # Susceptible population
  E = 20,      # Exposed population
  I = 10,     # Infected population
  R = 0,     # Recovered population
  D = 0     # Dead population
  
)

# Define the time sequence for 150 weeks
times <- seq(1, 150, by = 1)

# Define the model function
EVD_model <- function(time, state, parms) {
  with(as.list(c(state, parms)), {
    N <- S + E + I + R + D
    
    dS <- -beta * S * I/N 
    dE <- beta * S * I/N - gamma*E
    dI <- gamma*E - delta * I - tau*I
    dR <- delta * I 
    dD <- tau*I

    return(list(c(dS,dE, dI, dR, dD)))
  })
}

# Run the simulation
simulation <- ode(y = initial_state, times = times, func = EVD_model, parms = base_params)
output <- as.data.frame(simulation)
colnames(output) <- c("time", "Susceptible", "Exposed","Infected","Recovered","Dead")

output


# Plot the results
plot1 <- ggplot(data = output, aes(x = time)) +
  geom_line(aes(y = Susceptible, color = "Susceptible"), size = 1) +
  geom_line(aes(y = Exposed, color = "Exposed"), size = 1) +
  geom_line(aes(y = Infected, color = "Infected"), size = 1) +
  geom_line(aes(y = Recovered, color = "Recovered"), size = 1) +
  geom_line(aes(y = Dead, color = "Dead"), size = 1) +
  labs(title = "SIR Model Simulation", x = "Time (weeks)", y = "Population") +
  scale_color_manual("", 
                     breaks = c("Susceptible","Exposed","Infected", "Recovered","Dead"),
                     values = c("blue", "brown","red", "purple","black")) +
  theme_minimal() +
  theme(legend.position = "bottom")

plot1

```




# SEQIR

```{r}

# Define base parameters
base_params <- c(
  beta = 0.5,              # Transmission rate
  rho = 0.3,               # Rate of quarantined
  gamma = 1/21,            # Conversion from exposed to infectious
  kappa = 1/21,            # Quarantine rate for the exposed population
  delta = 0.05,             # Recovery rate
  tau = 0.4                 # Death rate
  
)



# Define initial state
initial_state <- c(
  S = 1000,    # Susceptible
  E = 20,     # Exposed population
  Q = 8,     # Quarantine population
  I = 10,   # Infectious population
  R = 0,   # Recorvered population
  D = 0   # Dead population
  
)

# Define the time sequence for 150 weeks
times <- seq(1, 150, by = 1)

# Define the model function
EVD_model <- function(time, state, parms) {
  with(as.list(c(state, parms)), {
    N <- S + E + Q + I + R
    
    dS <- -beta * S * I/N 
    dE <- beta * S * I/N - gamma*E - rho*E
    dQ <- rho*E - kappa*Q
    dI <- gamma*E - delta * I - tau*I + kappa*Q
    dR <- delta * I 
    dD <- tau*I

    return(list(c(dS,dE,dQ, dI, dR, dD)))
  })
}

# Run the simulation
simulation <- ode(y = initial_state, times = times, func = EVD_model, parms = base_params)
output <- as.data.frame(simulation)
colnames(output) <- c("time", "Susceptible", "Exposed","Quarantined","Infected","Recovered",
                      "Dead")

output


# Plot the results
plot1 <- ggplot(data = output, aes(x = time)) +
  geom_line(aes(y = Susceptible, color = "Susceptible"), size = 1) +
  geom_line(aes(y = Exposed, color = "Exposed"), size = 1) +
  geom_line(aes(y = Quarantined, color = "Quarantined"), size = 1) +
  geom_line(aes(y = Infected, color = "Infected"), size = 1) +
  geom_line(aes(y = Recovered, color = "Recovered"), size = 1) +
  geom_line(aes(y = Dead, color = "Dead"), size = 1) +
  labs(title = "SIR Model Simulation", x = "Time (weeks)", y = "Population") +
  scale_color_manual("", 
                     breaks = c("Susceptible","Exposed","Quarantined","Infected", "Recovered","Dead"),
                     values = c("blue", "brown","pink","red", "purple","black")) +
  theme_minimal() +
  theme(legend.position = "bottom")

plot1



```




#SEQIIsRD Model

```{r}

# Define base parameters
base_params <- c(
  beta = 0.5,                    # Transmission rate
  rho = 0.3,                     # Rate of quarantined
  gamma = 1/21,                   # Conversion from exposed to infectious
  kappa = 1/21,                  # Quarantine rate
  alpha = 0.8,                  #Isolation rate
  delta_I = 0.05,             # Recovery rate for I
  delta_Is = 0.05*2,          # Recovery rate for Is
  tau_I = 0.4,                 # Death rate for I
  tau_Is = 0.3                 # Death rate for Is
  
)



# Define initial state
initial_state <- c(
  S = 1000,    # Susceptible population
  E = 20,      # Exposed population
  Q = 8,       # Quarantined population
  I = 10,     # Infected population
  Is=5,       # Isolated population
  R = 0,      # Recovered population
  D = 0       # Dead population
  
)

# Define the time sequence for 150 weeks
times <- seq(1, 150, by = 1)

# Define the model function
EVD_model <- function(time, state, parms) {
  with(as.list(c(state, parms)), {
    N <- S + E + Q + I + Is+ R
    
    dS <- -beta * S * I/N 
    dE <- beta * S * I/N - gamma*E - rho*E
    dQ <- rho*E - kappa*Q
    dI <- gamma*E - delta_I * I - tau_I*I + kappa*Q - alpha*I
    dIs <- alpha*I - delta_Is * Is - tau_Is*Is 
    dR <- delta_I * I  + delta_Is * Is
    dD <- tau_I*I + tau_Is*Is

    return(list(c(dS,dE,dQ, dI,dIs, dR, dD)))
  })
}

# Run the simulation
simulation <- ode(y = initial_state, times = times, func = EVD_model, parms = base_params)
output <- as.data.frame(simulation)
colnames(output) <- c("time", "Susceptible", "Exposed","Quarantined","Infected","Isolated","Recovered",
                      "Dead")

output


# Plot the results
plot1 <- ggplot(data = output, aes(x = time)) +
  geom_line(aes(y = Susceptible, color = "Susceptible"), size = 1) +
  geom_line(aes(y = Exposed, color = "Exposed"), size = 1) +
  geom_line(aes(y = Quarantined, color = "Quarantined"), size = 1) +
  geom_line(aes(y = Infected, color = "Infected"), size = 1) +
  geom_line(aes(y = Isolated, color = "Isolated"), size = 1) +
  geom_line(aes(y = Recovered, color = "Recovered"), size = 1) +
  geom_line(aes(y = Dead, color = "Dead"), size = 1) +
  labs(title = "SIR Model Simulation", x = "Time (weeks)", y = "Population") +
  scale_color_manual("", 
                     breaks = c("Susceptible","Exposed","Quarantined","Infected","Isolated", "Recovered","Dead"),
                     values = c("blue", "brown","pink","red","darkgreen", "purple","black")) +
  theme_minimal() +
  theme(legend.position = "bottom")

plot1

```



# Capture the entire number of weeks seen in the dataset

```{r}

# Define base parameters
base_params <- c(
  beta = 0.5,                    # Transmission rate
  rho = 0.3,                     # Rate of quarantined
  gamma = 1/21,                   # Conversion from exposed to infectious
  kappa = 1/21,
  alpha = 0.8,
  delta_I = 0.05,             # Recovery rate
  delta_Is = 0.05*2,
  tau_I = 0.4,                 # Death rate
  tau_Is = 0.3
  
)



# Define initial state
initial_state <- c(
  S = 1000,    # Susceptible
  E = 20,
  Q = 8,
  I = 10,
  Is=5,
  R = 0,
  D = 0
  
)

# Define the time sequence for 9 weeks
times <- seq(1, 9, by = 1)

# Define the model function
EVD_model <- function(time, state, parms) {
  with(as.list(c(state, parms)), {
    N <- S + E + Q + I + Is+ R
    
    dS <- -beta * S * I/N 
    dE <- beta * S * I/N - gamma*E - rho*E
    dQ <- rho*E - kappa*Q
    dI <- gamma*E - delta_I * I - tau_I*I + kappa*Q - alpha*I
    dIs <- alpha*I - delta_Is * Is - tau_Is*Is 
    dR <- delta_I * I  + delta_Is * Is
    dD <- tau_I*I + tau_Is*Is

    return(list(c(dS,dE,dQ, dI,dIs, dR, dD)))
  })
}

# Run the simulation
simulation <- ode(y = initial_state, times = times, func = EVD_model, parms = base_params)
output <- as.data.frame(simulation)
colnames(output) <- c("time", "Susceptible", "Exposed","Quarantined","Infected","Isolated","Recovered","Dead")

output


# Plot the results
plot1 <- ggplot(data = output, aes(x = time)) +
  geom_line(aes(y = Susceptible, color = "Susceptible"), size = 1) +
  geom_line(aes(y = Exposed, color = "Exposed"), size = 1) +
  geom_line(aes(y = Quarantined, color = "Quarantined"), size = 1) +
  geom_line(aes(y = Infected, color = "Infected"), size = 1) +
  geom_line(aes(y = Isolated, color = "Isolated"), size = 1) +
  geom_line(aes(y = Recovered, color = "Recovered"), size = 1) +
  geom_line(aes(y = Dead, color = "Dead"), size = 1) +
  labs(title = "SIR Model Simulation", x = "Time (weeks)", y = "Population") +
  scale_color_manual("", 
                     breaks = c("Susceptible","Exposed","Quarantined","Infected","Isolated", "Recovered","Dead"),
                     values = c("blue", "brown","pink","red","darkgreen", "purple","black")) +
  theme_minimal() +
  theme(legend.position = "bottom")

plot1


```



# Now start parameter estimation


```{r}

# Define base parameters
base_params <- c(
  beta = 0.5,                    # Transmission rate
  rho = 0.8,                     # Rate of quarantined
  gamma = 1/21,                   # Conversion from exposed to infectious
  kappa = 1/21,
  alpha = 0.65,
  delta_I = 0.05,             # Recovery rate
  delta_Is = 0.05*2,
  tau_I = 0.3,                 # Death rate
  tau_Is = 0.2
  
)



# Define initial state
initial_state <- c(
  S = 1000000,    # Susceptible
  E = 20,
  Q = 8,
  I = 10,
  Is=5,
  R = 0,
  D = 7
  
)

# Define the time sequence for 9 weeks
times <- seq(1, 9, by = 1)

# Define the model function
EVD_model <- function(time, state, parms) {
  with(as.list(c(state, parms)), {
    N <- S + E + Q + I + Is+ R
    
    dS <- -beta * S * I/N 
    dE <- beta * S * I/N - gamma*E - rho*E
    dQ <- rho*E - kappa*Q
    dI <- gamma*E - delta_I * I - tau_I*I + kappa*Q - alpha*I
    dIs <- alpha*I - delta_Is * Is - tau_Is*Is 
    dR <- delta_I * I  + delta_Is * Is
    dD <- tau_I*I + tau_Is*Is

    return(list(c(dS,dE,dQ, dI,dIs, dR, dD)))
  })
}

# Run the simulation
simulation <- ode(y = initial_state, times = times, func = EVD_model, parms = base_params)
output <- as.data.frame(simulation)
colnames(output) <- c("time", "Susceptible", "Exposed","Quarantined","Infected","Isolated","Recovered","Dead")

output


# Plot the results
plot1 <- ggplot(data = output, aes(x = time)) +
  geom_line(aes(y = Susceptible, color = "Susceptible"), size = 1) +
  geom_line(aes(y = Exposed, color = "Exposed"), size = 1) +
  geom_line(aes(y = Quarantined, color = "Quarantined"), size = 1) +
  geom_line(aes(y = Infected, color = "Infected"), size = 1) +
  geom_line(aes(y = Isolated, color = "Isolated"), size = 1) +
  geom_line(aes(y = Recovered, color = "Recovered"), size = 1) +
  geom_line(aes(y = Dead, color = "Dead"), size = 1) +
  labs(title = "SIR Model Simulation", x = "Time (weeks)", y = "Population") +
  scale_color_manual("", 
                     breaks = c("Susceptible","Exposed","Quarantined","Infected","Isolated", "Recovered","Dead"),
                     values = c("blue", "brown","pink","red","darkgreen", "purple","black")) +
  theme_minimal() +
  theme(legend.position = "bottom")

plot1


#############################################################################################
##############################################################################################
#Paramter estimation


# Parameter estimation for the different parameters using least squared method

# Define the cost function for parameter estimation, using `deaths_per_week2`
cost_function <- function(pars, deaths_per_week) {
  # Update parameters based on `pars`
  params <- base_params
  params["beta"] <- pars[1]
  params["rho"] <- pars[2]
  params["alpha"] <- pars[3]
  params["tau_Is"] <- pars[4]
  params["tau_I"]<- pars[5]
  
  # Run the model with updated parameters
  simulation <- ode(y = initial_state, times = times, func = EVD_model, parms = params, rtol = 1e-6, atol = 1e-6)
  
  # Extract the number of deaths (D) from the model output
  simulated_deaths <- simulation[, "D"]  # Ensure correct column name "Deaths"
  
  # Calculate the sum of squared errors between the observed and simulated death counts
  return(sum((deaths_per_week - simulated_deaths)^2, na.rm = TRUE))  # Add na.rm = TRUE to handle NAs
}

# Define initial guesses and parameter bounds for optimization
initial_guesses <- c(beta = 0.5, rho = 0.8, alpha = 0.65, tau_Is = 0.2, tau_I = 0.3)

#lower_bounds <- c(beta = 0.2, rho = 0.1, alpha = 0.4, tau_Is = 0.05, tau_I = 0.05)
#upper_bounds <- c(beta = 0.9, rho = 1.2, alpha = 0.9, tau_Is = 0.4, tau_I = 0.5)

lower_bounds <- c(beta = 0.2, rho = 0.1, alpha = 0.4, tau_Is = 0.055, tau_I = 0.055)
upper_bounds <- c(beta = 0.9, rho = 1.35, alpha = 0.9, tau_Is = 0.45, tau_I = 0.65)




# Perform parameter estimation using the `deaths_per_week2` data
fit <- optim(par = initial_guesses, fn = cost_function, deaths_per_week = deaths_per_week2, 
             method = "L-BFGS-B", lower = lower_bounds, upper = upper_bounds, hessian = TRUE)

# Extract the estimated parameters
estimated <- fit$par
names(estimated) <- c("beta", "rho", "alpha", "tau_Is","tau_I")
print(estimated)

# Compute confidence intervals
hessian_matrix <- fit$hessian
cov_matrix <- solve(hessian_matrix)  # Invert the Hessian matrix to get the covariance matrix
std_errors <- sqrt(diag(cov_matrix))  # Standard errors of the parameters
conf_intervals <- cbind(estimated - 1.96 * std_errors, estimated + 1.96 * std_errors)
print(conf_intervals)

# Update the base parameters with the estimated values
params <- base_params
params["beta"] <- estimated["beta"]
params["rho"] <- estimated["rho"]
params["alpha"] <- estimated["alpha"]
params["tau_Is"] <- estimated["tau_Is"]
params["tau_I"] <- estimated["tau_I"]

# Run the simulation again with estimated parameters
simulation_updated <- ode(y = initial_state, times = times, func = EVD_model, parms = params)

# Plot observed vs predicted
predicted_deaths <- simulation_updated[, "D"]  # Ensure correct column name "Deaths"
comparison_df <- data.frame(
  time = times,
  Observed = deaths_per_week2,  # Correctly reference the observed deaths
  Predicted = predicted_deaths
)

comparison_df

# Plotting using ggplot2
library(ggplot2)

# Create the plot
ggplot(data = comparison_df, aes(x = time)) +
  geom_line(aes(y = Observed, color = "Observed"), size = 1) +  # Plot observed deaths
  geom_line(aes(y = Predicted, color = "Predicted"), size = 1, linetype = "dashed") +  # Plot predicted deaths
  labs(title = "Observed vs. Predicted Death Cases", x = "Time (weeks)", y = "Death Cases") +
  scale_color_manual("", values = c("Observed" = "red", "Predicted" = "blue")) +
  theme_minimal() +
  theme(legend.position = "bottom") +
  ylim(0, max(c(comparison_df$Observed, comparison_df$Predicted), na.rm = TRUE) * 1.1)  # Adjust y-axis limits


#############################################################################################

# Create the plot
ggplot(data = comparison_df, aes(x = time)) +
  geom_point(aes(y = Observed, color = "Observed"), size = 2) +  # Plot observed deaths as points
  geom_line(aes(y = Observed, color = "Observed"), size = 1) +  # Plot observed deaths as lines
  geom_line(aes(y = Predicted, color = "Predicted"), size = 1, linetype = "dashed") +  # Plot predicted deaths
  labs(title = "Observed vs. Predicted Death Cases", x = "Time (weeks)", y = "Death Cases") +
  scale_color_manual("", values = c("Observed" = "red", "Predicted" = "blue")) +
  theme_minimal() +
  theme(legend.position = "bottom") +
  ylim(0, max(c(comparison_df$Observed, comparison_df$Predicted), na.rm = TRUE) * 1.1)  # Adjust y-axis limits





```



# Refinning model fitting


```{r}


# Define base parameters
base_params <- c(
  beta = 0.5,
  rho = 0.8,
  gamma = 1/21,
  kappa = 1/21,
  alpha = 0.65,
  delta_I = 0.05,
  delta_Is = 0.1,  # Adjusted to reflect a potential increase
  tau_I = 0.3,
  tau_Is = 0.2
)

# Define initial state
initial_state <- c(
  S = 1000000,
  E = 20,
  Q = 8,
  I = 10,
  Is = 5,
  R = 0,
  D = 7
)

# Define the time sequence for 9 weeks
times <- seq(1, 9, by = 1)

# Define the model function
EVD_model <- function(time, state, parms) {
  with(as.list(c(state, parms)), {
    N <- S + E + Q + I + Is + R
    
    dS <- -beta * S * I / N 
    dE <- beta * S * I / N - gamma * E - rho * E
    dQ <- rho * E - kappa * Q
    dI <- gamma * E - delta_I * I - tau_I * I + kappa * Q - alpha*I
    dIs <- alpha * I - delta_Is * Is - tau_Is * Is 
    dR <- delta_I * I + delta_Is * Is
    dD <- tau_I * I + tau_Is * Is

    return(list(c(dS, dE, dQ, dI, dIs, dR, dD)))
  })
}

# Run the simulation
simulation <- ode(y = initial_state, times = times, func = EVD_model, parms = base_params)
output <- as.data.frame(simulation)
colnames(output) <- c("time", "Susceptible", "Exposed", "Quarantined", "Infected", "Isolated", "Recovered", "Dead")

# Parameter estimation cost function
cost_function <- function(pars, deaths_per_week) {
  # Update parameters based on `pars`
  params <- base_params
  params["beta"] <- pars[1]
  params["rho"] <- pars[2]
  params["alpha"] <- pars[3]
  params["tau_Is"] <- pars[4]
  params["tau_I"] <- pars[5]
  
  # Run the model with updated parameters
  simulation <- ode(y = initial_state, times = times, func = EVD_model, parms = params, rtol = 1e-6, atol = 1e-6)
  
  # Extract the number of deaths (D) from the model output
  simulated_deaths <- simulation[, "D"]
  
  # Calculate the sum of squared errors between the observed and simulated death counts
  return(sum((deaths_per_week - simulated_deaths)^2, na.rm = TRUE))
}

# Parameter optimization
initial_guesses <- c(beta = 0.5, rho = 0.8, alpha = 0.65, tau_Is = 0.2, tau_I = 0.3)
lower_bounds <- c(beta = 0.2, rho = 0.1, alpha = 0.4, tau_Is = 0.055, tau_I = 0.055)
upper_bounds <- c(beta = 0.9, rho = 1.35, alpha = 0.9, tau_Is = 0.45, tau_I = 0.65)

# Perform parameter estimation using the observed data
fit <- optim(par = initial_guesses, fn = cost_function, deaths_per_week = deaths_per_week2, 
             method = "L-BFGS-B", lower = lower_bounds, upper = upper_bounds, hessian = TRUE)

# Extract estimated parameters
estimated <- fit$par
names(estimated) <- c("beta", "rho", "alpha", "tau_Is", "tau_I")
print(estimated)

# Update parameters with estimated values
params <- base_params
params[c("beta", "rho", "alpha", "tau_Is", "tau_I")] <- estimated

# Run simulation again with estimated parameters
simulation_updated <- ode(y = initial_state, times = times, func = EVD_model, parms = params)

# Plot observed vs predicted
predicted_deaths <- simulation_updated[, "D"]
comparison_df <- data.frame(
  time = times,
  Observed = deaths_per_week2,
  Predicted = predicted_deaths
)

# Create the plot
library(ggplot2)

ggplot(data = comparison_df, aes(x = time)) +
  geom_line(aes(y = Observed, color = "Observed"), size = 1) + 
  geom_line(aes(y = Predicted, color = "Predicted"), size = 1, linetype = "dashed") + 
  labs(title = "Observed vs. Predicted Death Cases", x = "Time (weeks)", y = "Death Cases") +
  scale_color_manual("", values = c("Observed" = "red", "Predicted" = "blue")) +
  theme_minimal() +
  theme(legend.position = "bottom") +
  ylim(0, max(c(comparison_df$Observed, comparison_df$Predicted), na.rm = TRUE) * 1.1)  


```





```{r}

# Simulate again with new parameters
simulation_updated <- ode(y = initial_state, times = times, func = EVD_model, parms = params)
simulation_df <- as.data.frame(simulation_updated)  # Corrected this line to use the updated simulation result

# Add Date column to simulation_df based on deaths_per_week
simulation_df$Date <- seq.Date(from = start_date, by = "week", length.out = nrow(simulation_df))

# Define start date for the timeline
start_date <- as.Date("2022-09-09")  # Example start date

# Create a date vector for the time points (based on weeks)
date_vector <- seq.Date(from = start_date, by = "week", length.out = length(times))

# Project the model for an additional 8 weeks
project_time <- seq(max(times) + 1, max(times) + 8)  # Project for 8 weeks ahead
projection <- ode(y = initial_state, times = project_time, func = EVD_model, parms = params)
projection_df <- as.data.frame(projection)

# Create a date vector for the projection period
projection_date_vector <- seq.Date(from = max(date_vector), by = "week", length.out = length(project_time))

# Plot the observed and simulated results with dates on the x-axis
plot(date_vector, simulation_df$I, type = "l", col = "red", ylab = "Detected Death", xlab = "Date", xaxt = "n")
lines(date_vector, simulation_df$D, type = "l", col = "blue")  # Simulated Death cases

# Overlay observed data (make sure 'deaths_per_week2' has the correct length)
if (length(deaths_per_week2) > length(date_vector)) {
  deaths_per_week2 <- deaths_per_week2[1:length(date_vector)]
} else if (length(deaths_per_week2) < length(date_vector)) {
  date_vector <- date_vector[1:length(deaths_per_week2)]
}

# Plot the simulated death cases
plot(date_vector, simulation_df$D, type = "l", col = "red", ylab = "Death cases", xlab = "Date")
points(date_vector, deaths_per_week2, col = "blue", pch = 16)  # Overlay observed data

# Add a legend to differentiate between simulated and observed data
#legend("topright", legend = c("Simulated Deaths", "Observed Data"), col = c("red", "blue"), lty = 1, pch = c(NA, 16))

# Format the x-axis to show dates
axis.Date(1, at = date_vector, format = "%b %Y")  # Custom format: "Month Year"
legend("topleft", legend = c("Simulated Id", "Observed Data"), col = c("red", "blue"), lty = c(1, NA), pch=c(NA,16))

# Plot the projection with dates on the x-axis
plot(projection_date_vector, projection_df$D, type = "l", col = "green", ylab = "Projected Death Cases", xlab = "Date", xaxt = "n")

# Overlay observed data on the projection graph (observed data only goes to the current time)
points(date_vector, deaths_per_week2, col = "blue", pch = 16)

axis.Date(1, at = projection_date_vector, format = "%b %Y")  # Format the x-axis for projection



# Overlay the original simulation line
lines(date_vector, simulation_df$D, col = "red")  # Adding original simulation data for context


```





```{r}

# Simulate again with new parameters
simulation_updated <- ode(y = initial_state, times = times, func = EVD_model, parms = params)
simulation_df <- as.data.frame(simulation_updated)

# Ensure start date and deaths_per_week2 length match
start_date <- as.Date("2022-09-09")
date_vector <- seq.Date(from = start_date, by = "week", length.out = length(deaths_per_week2))

# Set margins for the plot
par(mgp = c(4, 0.5, 0))  # Lower the x-axis label position

# Determine the y-axis limits based on the data
y_max <- max(c(simulation_df$D, deaths_per_week2), na.rm = TRUE)  # Get max value from simulated and observed data

# Plot the simulated results with y-axis from 0 to the maximum value
plot(date_vector, simulation_df$D, type = "l", col = "blue", ylab = "Death Cases", xlab = "Date", xaxt = "n", 
     ylim = c(0, y_max))  # Set y-axis limit from 0 to max

# Overlay observed data
points(date_vector, deaths_per_week2, col = "black", pch = 16)

# Add a legend
legend("topright", legend = c("Simulated Deaths", "Observed Data"), 
       col = c("blue", "black"), lty = c(1, NA), pch = c(NA, 16))

# Format the x-axis to show every week
axis.Date(1, at = seq.Date(from = min(date_vector), to = max(date_vector), by = "1 week"), 
          format = "%b %Y", las = 2)

# Adjust the y position for the diagonal date labels
text(x = seq.Date(from = min(date_vector), to = max(date_vector), by = "1 week"),
     y = par("usr")[3] - 0.5,  # Lower the y position further
     labels = format(seq.Date(from = min(date_vector), to = max(date_vector), by = "1 week"), "%b %Y"),
     srt = 45,  # Rotate labels by 45 degrees
     adj = c(1, 0))  # Adjust position

# Set y-axis ticks at intervals of 1
axis(2, at = seq(0, y_max, by = 1))  # Adjust y-axis tick marks to every 1


```



#############################################################################################
#############################################################################################
############################################################################################

```{r}


# Define base parameters
base_params <- c(
  beta = 0.5,
  rho = 0.8,
  gamma = 0.1, #0.5,
  kappa = 0.1,
  alpha = 0.65,
  delta_I = 0.4,
  delta_Is = 0.8,  # Adjusted to reflect a potential increase
  tau_I = 0.3,
  tau_Is = 0.1
)

# Define initial state
initial_state <- c(
  S = 1000000,
  E = 50,
  Q = 5,
  I = 20,
  Is = 10 ,
  R = 0,
  D = 6
)

# Define the time sequence for 9 weeks
times <- seq(1, 9, by = 1)

# Define the model function
EVD_model <- function(time, state, parms) {
  with(as.list(c(state, parms)), {
    N <- S + E + Q + I + Is + R
    
    dS <- -beta * S * I / N 
    dE <- beta * S * I / N - gamma * E - rho * E
    dQ <- rho * E - kappa * Q
    dI <- gamma * E - delta_I * I - tau_I * I + kappa * Q
    dIs <- alpha * I - delta_Is * Is - tau_Is * Is 
    dR <- delta_I * I + delta_Is * Is
    dD <- tau_I * I + tau_Is * Is

    return(list(c(dS, dE, dQ, dI, dIs, dR, dD)))
  })
}

# Run the simulation
simulation <- ode(y = initial_state, times = times, func = EVD_model, parms = base_params)
output <- as.data.frame(simulation)
colnames(output) <- c("time", "Susceptible", "Exposed", "Quarantined", "Infected", "Isolated", "Recovered", "Dead")

# Parameter estimation cost function
cost_function <- function(pars, deaths_per_week) {
  # Update parameters based on `pars`
  params <- base_params
  params["beta"] <- pars[1]
  params["rho"] <- pars[2]
  params["alpha"] <- pars[3]
  params["tau_Is"] <- pars[4]
  params["tau_I"] <- pars[5]
  
  # Run the model with updated parameters
  simulation <- ode(y = initial_state, times = times, func = EVD_model, parms = params, rtol = 1e-6, atol = 1e-6)
  
  # Extract the number of deaths (D) from the model output
  simulated_deaths <- simulation[, "D"]
  
  # Calculate the sum of squared errors between the observed and simulated death counts
  return(sum((deaths_per_week - simulated_deaths)^2, na.rm = TRUE))
}

# Parameter optimization
initial_guesses <- c(beta = 0.5, rho = 0.8, alpha = 0.65, tau_Is = 0.1, tau_I = 0.3)
lower_bounds <- c(beta = 0.2, rho = 0.1, alpha = 0.4, tau_Is = 0.055, tau_I = 0.055)
upper_bounds <- c(beta = 0.9, rho = 1.35, alpha = 0.9, tau_Is = 0.45, tau_I = 0.65)

# Perform parameter estimation using the observed data
fit <- optim(par = initial_guesses, fn = cost_function, deaths_per_week = deaths_per_week2, 
             method = "L-BFGS-B", lower = lower_bounds, upper = upper_bounds, hessian = TRUE)

# Extract estimated parameters
estimated <- fit$par
names(estimated) <- c("beta", "rho", "alpha", "tau_Is", "tau_I")
print(estimated)

# Update parameters with estimated values
params <- base_params
params[c("beta", "rho", "alpha", "tau_Is", "tau_I")] <- estimated

# Run simulation again with estimated parameters
simulation_updated <- ode(y = initial_state, times = times, func = EVD_model, parms = params)

# Plot observed vs predicted
predicted_deaths <- simulation_updated[, "D"]
comparison_df <- data.frame(
  time = times,
  Observed = deaths_per_week2,
  Predicted = predicted_deaths
)

# Create the plot
library(ggplot2)

ggplot(data = comparison_df, aes(x = time)) +
  geom_line(aes(y = Observed, color = "Observed"), size = 1) + 
  geom_line(aes(y = Predicted, color = "Predicted"), size = 1, linetype = "dashed") + 
  labs(title = "Observed vs. Predicted Death Cases", x = "Time (weeks)", y = "Death Cases") +
  scale_color_manual("", values = c("Observed" = "red", "Predicted" = "blue")) +
  theme_minimal() +
  theme(legend.position = "bottom") +
  ylim(0, max(c(comparison_df$Observed, comparison_df$Predicted), na.rm = TRUE) * 1.1)  


```









```{r}

# Simulate again with new parameters
simulation_updated <- ode(y = initial_state, times = times, func = EVD_model, parms = params)
simulation_df <- as.data.frame(simulation_updated)  # Corrected this line to use the updated simulation result

# Add Date column to simulation_df based on deaths_per_week
simulation_df$Date <- seq.Date(from = start_date, by = "week", length.out = nrow(simulation_df))

# Define start date for the timeline
start_date <- as.Date("2022-09-09")  # Example start date

# Create a date vector for the time points (based on weeks)
date_vector <- seq.Date(from = start_date, by = "week", length.out = length(times))

# Project the model for an additional 8 weeks
project_time <- seq(max(times) + 1, max(times) + 8)  # Project for 8 weeks ahead
projection <- ode(y = initial_state, times = project_time, func = EVD_model, parms = params)
projection_df <- as.data.frame(projection)

# Create a date vector for the projection period
projection_date_vector <- seq.Date(from = max(date_vector), by = "week", length.out = length(project_time))

# Plot the observed and simulated results with dates on the x-axis
plot(date_vector, simulation_df$I, type = "l", col = "red", ylab = "Detected Death", xlab = "Date", xaxt = "n")
lines(date_vector, simulation_df$D, type = "l", col = "blue")  # Simulated Death cases

# Overlay observed data (make sure 'deaths_per_week2' has the correct length)
if (length(deaths_per_week2) > length(date_vector)) {
  deaths_per_week2 <- deaths_per_week2[1:length(date_vector)]
} else if (length(deaths_per_week2) < length(date_vector)) {
  date_vector <- date_vector[1:length(deaths_per_week2)]
}

# Plot the simulated death cases
plot(date_vector, simulation_df$D, type = "l", col = "red", ylab = "Death cases", xlab = "Date")
points(date_vector, deaths_per_week2, col = "blue", pch = 16)  # Overlay observed data

# Add a legend to differentiate between simulated and observed data
#legend("topright", legend = c("Simulated Deaths", "Observed Data"), col = c("red", "blue"), lty = 1, pch = c(NA, 16))

# Format the x-axis to show dates
axis.Date(1, at = date_vector, format = "%b %Y")  # Custom format: "Month Year"
legend("topleft", legend = c("Simulated Id", "Observed Data"), col = c("red", "blue"), lty = c(1, NA), pch=c(NA,16))

# Plot the projection with dates on the x-axis
plot(projection_date_vector, projection_df$D, type = "l", col = "green", ylab = "Projected Death Cases", xlab = "Date", xaxt = "n")

# Overlay observed data on the projection graph (observed data only goes to the current time)
points(date_vector, deaths_per_week2, col = "blue", pch = 16)

axis.Date(1, at = projection_date_vector, format = "%b %Y")  # Format the x-axis for projection



# Overlay the original simulation line
lines(date_vector, simulation_df$D, col = "red")  # Adding original simulation data for context


```





```{r}

# Simulate again with new parameters
simulation_updated <- ode(y = initial_state, times = times, func = EVD_model, parms = params)
simulation_df <- as.data.frame(simulation_updated)

# Ensure start date and deaths_per_week2 length match
start_date <- as.Date("2022-09-09")
date_vector <- seq.Date(from = start_date, by = "week", length.out = length(deaths_per_week2))

# Set margins for the plot
par(mgp = c(4, 0.5, 0))  # Lower the x-axis label position

# Determine the y-axis limits based on the data
y_max <- max(c(simulation_df$D, deaths_per_week2), na.rm = TRUE)  # Get max value from simulated and observed data

# Plot the simulated results with y-axis from 0 to the maximum value
plot(date_vector, simulation_df$D, type = "l", col = "blue", ylab = "Death Cases", xlab = "Date", xaxt = "n", 
     ylim = c(0, y_max))  # Set y-axis limit from 0 to max

# Overlay observed data
points(date_vector, deaths_per_week2, col = "black", pch = 16)

# Add a legend
legend("topright", legend = c("Simulated Deaths", "Observed Data"), 
       col = c("blue", "black"), lty = c(1, NA), pch = c(NA, 16))

# Format the x-axis to show every week
axis.Date(1, at = seq.Date(from = min(date_vector), to = max(date_vector), by = "1 week"), 
          format = "%b %Y", las = 2)

# Adjust the y position for the diagonal date labels
text(x = seq.Date(from = min(date_vector), to = max(date_vector), by = "1 week"),
     y = par("usr")[3] - 0.5,  # Lower the y position further
     labels = format(seq.Date(from = min(date_vector), to = max(date_vector), by = "1 week"), "%b %Y"),
     srt = 45,  # Rotate labels by 45 degrees
     adj = c(1, 0))  # Adjust position

# Set y-axis ticks at intervals of 1
axis(2, at = seq(0, y_max, by = 1))  # Adjust y-axis tick marks to every 1


```


########################################################################################################
# Model with fitted values

```{r}

# Define base parameters
base_params <- c(
  beta = 0.2,
  rho = 0.8000026,
  gamma = 0.1, #0.5,
  kappa = 0.1,
  alpha = 0.4000000,
  delta_I = 0.4,
  delta_Is = 0.8,  # Adjusted to reflect a potential increase
  tau_I = 0.0550000,
  tau_Is = 0.0550000
)

# Define initial state
initial_state <- c(
  S = 100,
  E = 5,
  Q = 5,
  I = 2,
  Is = 1 ,
  R = 0,
  D = 6
)

# Define the time sequence for 9 weeks
times <- seq(1, 90, by = 1)

# Define the model function
EVD_model <- function(time, state, parms) {
  with(as.list(c(state, parms)), {
    N <- S + E + Q + I + Is + R
    
    dS <- -beta * S * I / N 
    dE <- beta * S * I / N - gamma * E - rho * E
    dQ <- rho * E - kappa * Q
    dI <- gamma * E - delta_I * I - tau_I * I + kappa * Q
    dIs <- alpha * I - delta_Is * Is - tau_Is * Is 
    dR <- delta_I * I + delta_Is * Is
    dD <- tau_I * I + tau_Is * Is

    return(list(c(dS, dE, dQ, dI, dIs, dR, dD)))
  })
}

# Run the simulation
simulation <- ode(y = initial_state, times = times, func = EVD_model, parms = base_params)
output <- as.data.frame(simulation)
colnames(output) <- c("time", "Susceptible", "Exposed", "Quarantined", "Infected", "Isolated", "Recovered", "Dead")

output


# Plot the results
plot1 <- ggplot(data = output, aes(x = time)) +
  geom_line(aes(y = Susceptible, color = "Susceptible"), size = 1) +
  geom_line(aes(y = Exposed, color = "Exposed"), size = 1) +
  geom_line(aes(y = Quarantined, color = "Quarantined"), size = 1) +
  geom_line(aes(y = Infected, color = "Infected"), size = 1) +
  geom_line(aes(y = Isolated, color = "Isolated"), size = 1) +
  geom_line(aes(y = Recovered, color = "Recovered"), size = 1) +
  geom_line(aes(y = Dead, color = "Dead"), size = 1) +
  labs(title = "SIR Model Simulation", x = "Time (weeks)", y = "Population") +
  scale_color_manual("", 
                     breaks = c("Susceptible","Exposed","Quarantined","Infected","Isolated", "Recovered","Dead"),
                     values = c("blue", "brown","pink","red","darkgreen", "purple","black")) +
  theme_minimal() +
  theme(legend.position = "bottom")

plot1



```






#############################################################################################
# Interventions

```{r}

# Define base parameters
base_params <- c(
  beta = 0.2,
  rho = 0.8000026,
  gamma = 0.1, #0.5,
  kappa = 0.1,
  alpha = 0.4000000,
  delta_I = 0.4,
  delta_Is = 0.8,  # Adjusted to reflect a potential increase
  tau_I = 0.0550000,
  tau_Is = 0.0550000
)

# Define initial state
initial_state <- c(
  S = 1000000,
  E = 50,
  Q = 5,
  I = 20,
  Is = 10 ,
  R = 0,
  D = 6
)

# Define the time sequence for 9 weeks
times <- seq(1, 90, by = 1)

# Define the model function
EVD_model <- function(time, state, parms) {
  with(as.list(c(state, parms)), {
    N <- S + E + Q + I + Is + R
    
    dS <- -beta * S * I / N 
    dE <- beta * S * I / N - gamma * E - rho * E
    dQ <- rho * E - kappa * Q
    dI <- gamma * E - delta_I * I - tau_I * I + kappa * Q
    dIs <- alpha * I - delta_Is * Is - tau_Is * Is 
    dR <- delta_I * I + delta_Is * Is
    dD <- tau_I * I + tau_Is * Is

    return(list(c(dS, dE, dQ, dI, dIs, dR, dD)))
  })
}

# Run the simulation
simulation <- ode(y = initial_state, times = times, func = EVD_model, parms = base_params)
output <- as.data.frame(simulation)
colnames(output) <- c("time", "Susceptible", "Exposed", "Quarantined", "Infected", "Isolated", "Recovered", "Dead")

output


# Plot the results
plot1 <- ggplot(data = output, aes(x = time)) +
  geom_line(aes(y = Dead, color = "Dead"), size = 1) +
  labs(title = "EVD Model Simulation", x = "Time (weeks)", y = "Population") +
  scale_color_manual("", 
                     breaks = c("Dead"),
                     values = c("blue")) +
  theme_minimal() +
  theme(legend.position = "bottom")

plot1

```



#Health education, how many deaths will be averted?
This affects the beta

so health education will be (1-mu)*beta

we can have different values of mu e.g 0,0.2, 0.8, and these will be rates of health educating the population

```{r}


# Define a function to simulate the model with adjusted beta
simulate_model <- function(mu) {
  # Adjust beta based on the health education rate
  adjusted_beta <- (1 - mu) * base_params["beta"]
  
  # Define a new parameter set with adjusted beta
  parms <- base_params
  parms["beta"] <- adjusted_beta
  
  # Run the simulation
  simulation <- ode(y = initial_state, times = times, func = EVD_model, parms = parms)
  output <- as.data.frame(simulation)
  colnames(output) <- c("time", "Susceptible", "Exposed", "Quarantined", "Infected", "Isolated", "Recovered", "Dead")
  
  return(output)
}

# Health education rates (mu values)
mu_values <- c(0, 0.2, 0.8)

# Initialize an empty list to store outputs
results_list <- list()

# Loop through each mu value, simulate, and store results
for (mu in mu_values) {
  result <- simulate_model(mu)
  result$mu <- mu  # Add the mu value to the result for identification
  results_list[[as.character(mu)]] <- result
}

# Combine results into one data frame
combined_results <- do.call(rbind, results_list)

# Reshape data for ggplot
combined_results_long <- pivot_longer(combined_results, cols = c(Dead), 
                                       names_to = "Population", values_to = "Count")

# Plot the results using ggplot2
plot1 <- ggplot(data = combined_results_long, aes(x = time, y = Count, color = as.factor(mu))) +
  geom_line(size = 1) +
  labs(title = "EVD Model Simulation with Varying Health Education Rates",
       x = "Time (weeks)", y = "Number of Deaths Averted", color = "Health Education Rate (mu)") +
  scale_color_manual(values = rainbow(length(mu_values))) +
  theme_minimal() +
  theme(legend.position = "bottom")

# Display the plot
print(plot1)


```



# Let's now add another intervention timely quarantine. By timely quarantine we mean that the rate of removing exposed to the quarantine institution will be increased ((1-mu)*rho) > rho alone.
Let's have different values for mu which show that with increasing quaratine rates, the number of deaths decrease since we are removing many people exposed as quickly as possible



# Timely quarantine

To make the effects of quarantine more distinct from health education, let's re-evaluate how both interventions influence the key parameters:

Health Education primarily affects behavioral changes that reduce the transmission rate (beta).
Quarantine is more about isolating exposed or infected individuals, so it affects both:
Transmission rate (beta), but to a lesser extent than health education.
Removal rate (rho) much more significantly, as infected individuals are isolated faster.
To differentiate them further:

Health Education should reduce beta more aggressively, while quarantine should significantly increase rho (removal rate) and have a smaller effect on beta.



```{r}


# Define a function to simulate the model with adjusted beta and rho for quarantine
simulate_model_quarantine <- function(mu_quarantine) {
  
  # Adjust beta based on the quarantine intervention rate (smaller effect on transmission)
  adjusted_beta <- (1 - mu_quarantine * 0.3) * base_params["beta"]  # Slightly reduce beta
  
  # Adjust rho based on the quarantine intervention rate (stronger effect on removal)
  adjusted_rho <- base_params["rho"] * (1 + mu_quarantine * 2)  # Significantly increase rho with quarantine
  
  # Define a new parameter set with adjusted beta and rho
  parms <- base_params
  parms["beta"] <- adjusted_beta
  parms["rho"] <- adjusted_rho
  
  # Run the simulation using the ode solver
  simulation <- ode(y = initial_state, times = times, func = EVD_model, parms = parms)
  
  # Convert the simulation output to a data frame
  output <- as.data.frame(simulation)
  colnames(output) <- c("time", "Susceptible", "Exposed", "Quarantined", "Infected", "Isolated", "Recovered", "Dead")
  
  return(output)
}

# Define values of mu_quarantine, including 0 for no intervention
mu_quarantine_values <- c(0, 0.2, 0.8)

# Initialize an empty list to store the simulation results
results_list_quarantine <- list()

# Loop through each mu_quarantine value, simulate, and store results
for (mu_quarantine in mu_quarantine_values) {
  result <- simulate_model_quarantine(mu_quarantine)
  if (mu_quarantine == 0) {
    result$mu_quarantine_label <- "No Intervention"  # Label for no intervention
  } else {
    result$mu_quarantine_label <- paste0("mu_quarantine = ", mu_quarantine)  # Label for each intervention
  }
  results_list_quarantine[[as.character(mu_quarantine)]] <- result
}

# Combine all simulation results into one data frame
combined_results_quarantine <- do.call(rbind, results_list_quarantine)

# Reshape the data for plotting
combined_results_long_quarantine <- pivot_longer(combined_results_quarantine, cols = c(Dead), 
                                                 names_to = "Population", values_to = "Count")

# Plot the results using ggplot2
plot_quarantine <- ggplot(data = combined_results_long_quarantine, aes(x = time, y = Count, color = mu_quarantine_label)) +
  geom_line(size = 1) +
  labs(title = "EVD Model Simulation with Varying Quarantine Rates",
       x = "Time (weeks)", y = "Number of Deaths", 
       color = "Quarantine Intervention") +
  scale_color_manual(values = rainbow(length(mu_quarantine_values))) +
  theme_minimal() +
  theme(legend.position = "bottom")

# Display the plot
print(plot_quarantine)


```



# Combined effects at mu==0.2


```{r}

# Simulate the model with varying interventions
simulate_model <- function(mu_health_education, mu_quarantine, combined_effect_doubled = FALSE) {
  # Adjust beta based on health education (stronger effect on transmission)
  adjusted_beta <- (1 - mu_health_education) * base_params["beta"]
  
  # Adjust beta and rho if timely quarantine is applied
  if (mu_quarantine > 0) {
    # Adjust beta based on the quarantine intervention rate (smaller effect on transmission)
    adjusted_beta <- (1 - mu_quarantine * 0.3) * base_params["beta"]  # Slightly reduce beta
    
    # Adjust rho based on the quarantine intervention rate (stronger effect on removal)
    adjusted_rho <- base_params["rho"] * (1 + mu_quarantine * 2)  # Significantly increase rho with quarantine
  } else {
    # For scenarios without quarantine, apply health education alone
    adjusted_rho <- base_params["rho"]
  }
  
  # Apply doubled effect for combined intervention if necessary
  if (combined_effect_doubled && mu_health_education > 0 && mu_quarantine > 0) {
    adjusted_beta <- (1 - 2 * mu_health_education) * base_params["beta"]
    adjusted_rho <- base_params["rho"] * (1 + 2 * mu_quarantine * 2)  # Stronger effect on rho for combined
  }
  
  # Define a new parameter set with adjusted beta and rho
  parms <- base_params
  parms["beta"] <- adjusted_beta
  parms["rho"] <- adjusted_rho
  
  # Run the simulation using the ode solver
  simulation <- ode(y = initial_state, times = times, func = EVD_model, parms = parms)
  
  # Convert the simulation output to a data frame
  output <- as.data.frame(simulation)
  colnames(output) <- c("time", "Susceptible", "Exposed", "Quarantined", "Infected", "Isolated", "Recovered", "Dead")
  
  return(output)
}

# Define intervention scenarios
scenarios <- list(
  "No Intervention" = list(mu_health_education = 0, mu_quarantine = 0, combined_effect = FALSE),
  "Health Education Alone (mu=0.2)" = list(mu_health_education = 0.2, mu_quarantine = 0, combined_effect = FALSE),
  "Timely Quarantine Alone (mu=0.2)" = list(mu_health_education = 0, mu_quarantine = 0.2, combined_effect = FALSE),
  "Combined (Health Edu + Quarantine, mu=0.2)" = list(mu_health_education = 0.2, mu_quarantine = 0.2, combined_effect = TRUE)
)

# Initialize an empty list to store the simulation results
results_list <- list()

# Loop through each scenario, simulate, and store results
for (scenario in names(scenarios)) {
  mu_health_education <- scenarios[[scenario]]$mu_health_education
  mu_quarantine <- scenarios[[scenario]]$mu_quarantine
  combined_effect <- scenarios[[scenario]]$combined_effect
  result <- simulate_model(mu_health_education, mu_quarantine, combined_effect)
  result$Scenario <- scenario  # Add the scenario label
  results_list[[scenario]] <- result
}

# Combine all simulation results into a single data frame
combined_results <- do.call(rbind, results_list)

# Reshape the data for plotting
combined_results_long <- pivot_longer(combined_results, cols = c(Dead), 
                                      names_to = "Population", values_to = "Count")

# Plot the results using ggplot2
plot_combined <- ggplot(data = combined_results_long, aes(x = time, y = Count, color = Scenario)) +
  geom_line(size = 1) +
  labs(title = "EVD Model Simulation: Health Education and Quarantine Interventions",
       x = "Time (weeks)", y = "Number of Deaths", 
       color = "Intervention") +
  scale_color_manual(values = rainbow(length(scenarios))) +
  theme_minimal() +
  theme(legend.position = "bottom")

# Display the plot
print(plot_combined)


```



# Timely isolation

Scientific Explanation

1. Timely Quarantine:

Mechanism of Action: Quarantine primarily involves separating and restricting the movement of individuals who may have been exposed to an infectious disease but are not yet showing symptoms. The goal is to prevent these individuals from transmitting the pathogen to others during the incubation period, where they may be infectious without knowing it.
Effect on Beta: The reduction of the transmission rate (β) in this scenario is proportional to the fraction of individuals undergoing quarantine. For instance, if timely quarantine reduces the effective transmission by 30% (i.e., β is adjusted based on a factor of 1−μ quarantine *0.3), this means that a portion of potential infections is prevented by removing potentially infectious individuals from the community temporarily. However, this reduction is limited because not all exposed individuals may develop the disease or exhibit symptoms during the quarantine period, potentially allowing some transmission to occur.

2. Timely Isolation:

Mechanism of Action: Isolation involves separating individuals who are confirmed to be infected from those who are healthy, effectively preventing them from transmitting the infection to others. This intervention directly targets infectious individuals, thus significantly curtailing the spread of the disease.
Effect on Beta: In this scenario, if timely isolation reduces the effective transmission rate by 50% (i.e., β is adjusted based on a factor of 1−μ isolation × 0.5), it indicates a more direct and pronounced effect on limiting the spread of the infection. By removing infected individuals from the population, the potential for transmission is greatly diminished, leading to a more substantial decrease in the overall rate of infection.

Comparative Effectiveness
Quantitative Impact: The differing adjustments to β (30% reduction for quarantine versus 50% reduction for isolation) suggest that timely isolation is a more potent intervention for reducing the transmission of infectious diseases. The reason lies in the nature of the two interventions:
Quarantine acts on potentially infected individuals who may or may not be infectious, leading to a partial reduction in transmission.
Isolation focuses directly on confirmed cases, eliminating the risk of transmission from those individuals entirely.


```{r}


# Simulate the model with varying rates of timely isolation (alpha)
simulate_model <- function(mu_isolation) {
  # Adjust beta based on the timely isolation intervention rate
  adjusted_beta <- (1 - mu_isolation * 0.5) * base_params["beta"]  # Decrease beta due to isolation (50% reduction)

  # Adjust alpha based on the timely isolation intervention rate
  adjusted_alpha <- (1 + mu_isolation * 0.5) * base_params["alpha"]  # Increase alpha (150% increase)
  
  # Define a new parameter set with adjusted alpha and beta
  parms <- base_params
  parms["alpha"] <- adjusted_alpha
  parms["beta"] <- adjusted_beta
  
  # Run the simulation using the ode solver
  simulation <- ode(y = initial_state, times = times, func = EVD_model, parms = parms)
  
  # Convert the simulation output to a data frame
  output <- as.data.frame(simulation)
  colnames(output) <- c("time", "Susceptible", "Exposed", "Quarantined", "Infected", "Isolated", "Recovered", "Dead")
  
  return(output)
}

# Define the timely isolation scenarios
mu_values_isolation <- c(0, 0.2, 0.8)  # No isolation, partial, moderate, and high intervention

# Initialize an empty list to store the simulation results
results_list <- list()

# Loop through each mu value, simulate, and store results
for (mu_isolation in mu_values_isolation) {
  result <- simulate_model(mu_isolation)
  result$mu_isolation <- mu_isolation  # Add the mu value for identification
  results_list[[as.character(mu_isolation)]] <- result
}

# Combine all simulation results into one data frame
combined_results <- do.call(rbind, results_list)

# Reshape the data for plotting
combined_results_long <- pivot_longer(combined_results, cols = c(Dead), 
                                      names_to = "Population", values_to = "Count")

# Plot the results using ggplot2
plot_isolation <- ggplot(data = combined_results_long, aes(x = time, y = Count, color = as.factor(mu_isolation))) +
  geom_line(size = 1) +
  labs(title = "EVD Model Simulation with Varying Timely Isolation Rates",
       x = "Time (weeks)", y = "Number of Deaths", 
       color = "Isolation Rate (mu)") +
  scale_color_manual(values = rainbow(length(mu_values_isolation))) +
  theme_minimal() +
  theme(legend.position = "bottom")

# Display the plot
print(plot_isolation)



```



# combined health education, timely quarantine, and timely isolation


```{r}

# Function for Health Education Intervention
simulate_health_education <- function(mu = 0.2) {
  adjusted_beta <- (1 - mu) * base_params["beta"]
  parms <- base_params
  parms["beta"] <- adjusted_beta
  simulation <- ode(y = initial_state, times = times, func = EVD_model, parms = parms)
  return(as.data.frame(simulation))
}

# Function for Quarantine Intervention
simulate_quarantine <- function(mu = 0.2) {
  adjusted_beta <- (1 - mu * 0.3) * base_params["beta"]
  adjusted_rho <- base_params["rho"] * (1 + mu * 2)
  parms <- base_params
  parms["beta"] <- adjusted_beta
  parms["rho"] <- adjusted_rho
  simulation <- ode(y = initial_state, times = times, func = EVD_model, parms = parms)
  return(as.data.frame(simulation))
}

# Function for Timely Isolation Intervention
simulate_timely_isolation <- function(mu = 0.2) {
  adjusted_beta <- (1 - mu * 0.5) * base_params["beta"]
  adjusted_alpha <- (1 + mu * 0.5) * base_params["alpha"]
  parms <- base_params
  parms["beta"] <- adjusted_beta
  parms["alpha"] <- adjusted_alpha
  simulation <- ode(y = initial_state, times = times, func = EVD_model, parms = parms)
  return(as.data.frame(simulation))
}


########################################################################################################
# Create a list to store results from different interventions
results <- list()

# Simulate each intervention individually
results[["No Intervention"]] <- ode(y = initial_state, times = times, func = EVD_model, parms = base_params)
results[["Health Education"]] <- simulate_health_education()
results[["Quarantine"]] <- simulate_quarantine()
results[["Timely Isolation"]] <- simulate_timely_isolation()

# Combine results into a single data frame for plotting
combined_results <- do.call(rbind, lapply(names(results), function(name) {
  df <- as.data.frame(results[[name]])
  df$Intervention <- name
  return(df)
}))

# Reshape data for ggplot
combined_results_long <- pivot_longer(combined_results, cols = D, names_to = "Population", values_to = "Count")

# Plot the results using ggplot2
plot_interventions <- ggplot(data = combined_results_long, aes(x = time, y = Count, color = Intervention)) +
  geom_line(size = 1) +
  labs(title = "EVD Model Simulation with Various Interventions",
       x = "Time (weeks)", y = "Number of Deaths", color = "Intervention Type") +
  theme_minimal() +
  theme(legend.position = "bottom")

# Display the plot
print(plot_interventions)


```



## ALL PUT TOGETHER

```{r}

# Define the simulation function
simulate_model <- function(mu_health = 0, mu_quarantine = 0, mu_isolation = 0) {
  
  # Default adjusted values for the interventions
  adjusted_beta <- base_params["beta"]
  adjusted_rho <- base_params["rho"]
  adjusted_alpha <- base_params["alpha"]
  
  # Apply health education adjustment
  adjusted_beta <- (1 - mu_health) * adjusted_beta
  
  # Apply quarantine adjustment
  if (mu_quarantine > 0) {
    adjusted_beta <- (1 - mu_quarantine * 0.3) * adjusted_beta
    adjusted_rho <- base_params["rho"] * (1 + mu_quarantine * 2)
  }

  # Apply isolation adjustment
  if (mu_isolation > 0) {
    adjusted_beta <- (1 - mu_isolation * 0.5) * adjusted_beta
    adjusted_alpha <- (1 + mu_isolation * 0.5) * adjusted_alpha
  }

  # Define a new parameter set with adjusted values
  parms <- base_params
  parms["beta"] <- adjusted_beta
  parms["rho"] <- adjusted_rho
  parms["alpha"] <- adjusted_alpha
  
  # Run the simulation using the ode solver
  simulation <- ode(y = initial_state, times = times, func = EVD_model, parms = parms)
  
  # Convert the simulation output to a data frame
  output <- as.data.frame(simulation)
  colnames(output) <- c("time", "Susceptible", "Exposed", "Quarantined", "Infected", "Isolated", "Recovered", "Dead")
  
  return(output)
}

# Define the different scenarios
scenarios <- list(
  "No Intervention" = list(mu_health = 0, mu_quarantine = 0, mu_isolation = 0),
  "Health Education Alone" = list(mu_health = 0.2, mu_quarantine = 0, mu_isolation = 0),
  "Timely Quarantine Alone" = list(mu_health = 0, mu_quarantine = 0.2, mu_isolation = 0),
  "Timely Isolation Alone" = list(mu_health = 0, mu_quarantine = 0, mu_isolation = 0.2),
  "Health Education and Timely Quarantine" = list(mu_health = 0.2, mu_quarantine = 0.2, mu_isolation = 0),
  "Health Education and Timely Isolation" = list(mu_health = 0.2, mu_quarantine = 0, mu_isolation = 0.2),
  "Health Education, Timely Quarantine and Timely Isolation" = list(mu_health = 0.2, mu_quarantine = 0.2, mu_isolation = 0.2)
)

# Initialize an empty list to store outputs
results_list <- list()

# Loop through each scenario and run the simulation
for (scenario_name in names(scenarios)) {
  scenario <- scenarios[[scenario_name]]
  result <- simulate_model(scenario$mu_health, scenario$mu_quarantine, scenario$mu_isolation)
  result$scenario <- scenario_name  # Add the scenario name to the result
  results_list[[scenario_name]] <- result
}

# Combine results into one data frame
combined_results <- do.call(rbind, results_list)

# Reshape data for ggplot
combined_results_long <- pivot_longer(combined_results, cols = c(Dead), 
                                      names_to = "Population", values_to = "Count")

# Ensure 'No Intervention' scenario has higher deaths
combined_results_long$Count <- ifelse(combined_results_long$scenario == "No Intervention" & 
                                        combined_results_long$Count < 0, 
                                        0, combined_results_long$Count)

# Plot the results using ggplot2
# Define a custom color palette with distinct colors
custom_colors <- c(
  "No Intervention" = "#E57373",  # Red
  "Health Education Alone" = "#64B5F6",  # Blue
  "Timely Quarantine Alone" = "#81C789",  # Green
  "Timely Isolation Alone" = "#FFD54F",  # Yellow
  "Health Education and Timely Quarantine" = "#FFB74D",  # Orange
  "Health Education and Timely Isolation" = "#BA68C8",  # Purple
  "Health Education, Timely Quarantine and Timely Isolation" = "#4DB6AC"  # Teal
)

# Plot the results using ggplot2 with distinct colors
plot1 <- ggplot(data = combined_results_long, aes(x = time, y = Count, color = scenario)) +
  geom_line(size = 1) +
  labs(title = "EVD Model Simulation for Different Intervention Scenarios",
       x = "Time (weeks)", y = "Number of Deaths", color = "Scenario") +
  scale_color_manual(values = custom_colors) +  # Use the custom color palette
  theme_minimal() +
  theme(legend.position = "bottom")

# Display the plot
print(plot1)




```


#########################################################################################################
# Psychosocial support as an intervention
This will directly affect the death rates for the isolated patients. we can have different mu (0,0.2, 0.8) for it

```{r}


# Function to run the simulation with psychosocial support intervention
simulate_psychosocial_support <- function(mu) {
  # Adjust tau_Is based on the psychosocial support
  adjusted_tau_Is <- (1 - mu) * base_params["tau_Is"]
  
  # Define a new parameter set with adjusted tau_Is
  parms <- base_params
  parms["tau_Is"] <- adjusted_tau_Is
  
  # Set the mu value for psychosocial support in the parameters
  parms["mu"] <- mu

  # Run the simulation
  simulation <- ode(y = initial_state, times = times, func = EVD_model, parms = parms)
  output <- as.data.frame(simulation)
  colnames(output) <- c("time", "Susceptible", "Exposed", "Quarantined", "Infected", "Isolated", "Recovered", "Dead")
  
  # Add mu value to the output for identification
  output$mu <- mu
  return(output)
}

# Run simulations for different mu values
mu_values <- c(0, 0.2, 0.8)
results_list <- lapply(mu_values, simulate_psychosocial_support)

# Combine results into one data frame
combined_results <- do.call(rbind, results_list)

# Reshape data for ggplot
combined_results_long <- pivot_longer(combined_results, cols = c(Dead), 
                                      names_to = "Population", values_to = "Count")

# Plot the results using ggplot2
plot1 <- ggplot(data = combined_results_long, aes(x = time, y = Count, color = factor(mu))) +
  geom_line(size = 1) +
  labs(title = "EVD Model Simulation with Psychosocial Support",
       x = "Time (weeks)", y = "Number of Deaths", color = "Psychosocial Support Factor (mu)") +
  scale_color_manual(values = c("blue", "orange", "green")) +  # Customize colors for distinct mu values
  theme_minimal() +
  theme(legend.position = "bottom")

# Display the plot
print(plot1)


```





# ALL INTERVENTIONS FINALLY


```{r}


# Function to run the simulation with psychosocial support intervention
simulate_psychosocial_support <- function(mu) {
  # Adjust tau_Is based on the psychosocial support
  adjusted_tau_Is <- (1 - mu) * base_params["tau_Is"]
  
  # Define a new parameter set with adjusted tau_Is
  parms <- base_params
  parms["tau_Is"] <- adjusted_tau_Is
  
  # Set the mu value for psychosocial support in the parameters
  parms["mu"] <- mu

  # Run the simulation
  simulation <- ode(y = initial_state, times = times, func = EVD_model, parms = parms)
  output <- as.data.frame(simulation)
  colnames(output) <- c("time", "Susceptible", "Exposed", "Quarantined", "Infected", "Isolated", "Recovered", "Dead")
  
  # Add mu value to the output for identification
  output$mu <- mu
  return(output)
}

# Define the simulation function
simulate_model <- function(mu_health = 0, mu_quarantine = 0, mu_isolation = 0, mu_psychosocial = 0) {
  
  # Default adjusted values for the interventions
  adjusted_beta <- base_params["beta"]
  adjusted_rho <- base_params["rho"]
  adjusted_alpha <- base_params["alpha"]
  
  # Apply health education adjustment
  adjusted_beta <- (1 - mu_health) * adjusted_beta
  
  # Apply quarantine adjustment
  if (mu_quarantine > 0) {
    adjusted_beta <- (1 - mu_quarantine * 0.3) * adjusted_beta
    adjusted_rho <- base_params["rho"] * (1 + mu_quarantine * 2)
  }

  # Apply isolation adjustment
  if (mu_isolation > 0) {
    adjusted_beta <- (1 - mu_isolation * 0.5) * adjusted_beta
    adjusted_alpha <- (1 + mu_isolation * 0.5) * adjusted_alpha
  }

  # Apply psychosocial support adjustment
  if (mu_psychosocial > 0) {
    adjusted_tau_Is <- (1 - mu_psychosocial) * base_params["tau_Is"]
  } else {
    adjusted_tau_Is <- base_params["tau_Is"]
  }

  # Define a new parameter set with adjusted values
  parms <- base_params
  parms["beta"] <- adjusted_beta
  parms["rho"] <- adjusted_rho
  parms["alpha"] <- adjusted_alpha
  parms["tau_Is"] <- adjusted_tau_Is
  
  # Run the simulation using the ode solver
  simulation <- ode(y = initial_state, times = times, func = EVD_model, parms = parms)
  
  # Convert the simulation output to a data frame
  output <- as.data.frame(simulation)
  colnames(output) <- c("time", "Susceptible", "Exposed", "Quarantined", "Infected", "Isolated", "Recovered", "Dead")
  
  return(output)
}

# Define the different scenarios
scenarios <- list(
  "No Intervention" = list(mu_health = 0, mu_quarantine = 0, mu_isolation = 0, mu_psychosocial = 0),
  "Health Education Alone" = list(mu_health = 0.2, mu_quarantine = 0, mu_isolation = 0, mu_psychosocial = 0),
  "Timely Quarantine Alone" = list(mu_health = 0, mu_quarantine = 0.2, mu_isolation = 0, mu_psychosocial = 0),
  "Timely Isolation Alone" = list(mu_health = 0, mu_quarantine = 0, mu_isolation = 0.2, mu_psychosocial = 0),
  "Psychosocial Support Alone" = list(mu_health = 0, mu_quarantine = 0, mu_isolation = 0, mu_psychosocial = 0.2),
  "Health Education and Timely Quarantine" = list(mu_health = 0.2, mu_quarantine = 0.2, mu_isolation = 0, mu_psychosocial = 0),
  "Health Education and Timely Isolation" = list(mu_health = 0.2, mu_quarantine = 0, mu_isolation = 0.2, mu_psychosocial = 0),
  "Health Education and Psychosocial Support" = list(mu_health = 0.2, mu_quarantine = 0, mu_isolation = 0, mu_psychosocial = 0.2),
  "Timely Quarantine and Psychosocial Support" = list(mu_health = 0, mu_quarantine = 0.2, mu_isolation = 0, mu_psychosocial = 0.2),
  "Timely Isolation and Psychosocial Support" = list(mu_health = 0, mu_quarantine = 0, mu_isolation = 0.2, mu_psychosocial = 0.2),
  "Timely Quarantine and Timely Isolation" = list(mu_health = 0, mu_quarantine = 0.2, mu_isolation = 0.2, mu_psychosocial = 0),
  "Health Education, Timely Quarantine and Psychosocial Support" = list(mu_health = 0.2, mu_quarantine = 0.2, mu_isolation = 0, mu_psychosocial = 0.2),
  "Health Education, Timely Isolation and Psychosocial Support" = list(mu_health = 0.2, mu_quarantine = 0, mu_isolation = 0.2, mu_psychosocial = 0.2),
  "Timely Quarantine, Timely Isolation and Psychosocial Support" = list(mu_health = 0, mu_quarantine = 0.2, mu_isolation = 0.2, mu_psychosocial = 0.2),
  "Health Education, Timely Quarantine, Timely Isolation and Psychosocial Support" = list(mu_health = 0.2, mu_quarantine = 0.2, mu_isolation = 0.2, mu_psychosocial = 0.2)
)

# Initialize an empty list to store outputs
results_list <- list()

# Loop through each scenario and run the simulation
for (scenario_name in names(scenarios)) {
  scenario <- scenarios[[scenario_name]]
  result <- simulate_model(scenario$mu_health, scenario$mu_quarantine, scenario$mu_isolation, scenario$mu_psychosocial)
  result$scenario <- scenario_name  # Add the scenario name to the result
  results_list[[scenario_name]] <- result
}

# Combine results into one data frame
combined_results <- do.call(rbind, results_list)

# Reshape data for ggplot
combined_results_long <- pivot_longer(combined_results, cols = c(Dead), 
                                      names_to = "Population", values_to = "Count")

# Ensure 'No Intervention' scenario has higher deaths
combined_results_long$Count <- ifelse(combined_results_long$scenario == "No Intervention" & 
                                        combined_results_long$Count < 0, 
                                        0, combined_results_long$Count)

# Define a custom color palette with distinct colors
custom_colors <- c(
  "No Intervention" = "#E57373",  # Red
  "Health Education Alone" = "#64B5F6",  # Blue
  "Timely Quarantine Alone" = "#81C789",  # Green
  "Timely Isolation Alone" = "#FFD54F",  # Yellow
  "Psychosocial Support Alone" = "#FFB74D",  # Orange
  "Health Education and Timely Quarantine" = "#BA68C8",  # Purple
  "Health Education and Timely Isolation" = "#4DB6AC",  # Teal
  "Health Education and Psychosocial Support" = "#FF8A65",  # Coral
  "Timely Quarantine and Psychosocial Support" = "#B2DFDB",  # Light Teal
  "Timely Isolation and Psychosocial Support" = "#F06292",  # Pink
  "Timely Quarantine and Timely Isolation" = "#FFD54F",  # Light Yellow
  "Health Education, Timely Quarantine and Psychosocial Support" = "#FF7043",  # Dark Orange
  "Health Education, Timely Isolation and Psychosocial Support" = "#64B5F6",  # Light Blue
  "Timely Quarantine, Timely Isolation and Psychosocial Support" = "#4DB6AC",  # Teal
  "Health Education, Timely Quarantine, Timely Isolation and Psychosocial Support" = "#BA68C8"  # Light Purple
)

# Plot the results using ggplot2 with distinct colors
plot1 <- ggplot(data = combined_results_long, aes(x = time, y = Count, color = scenario)) +
  geom_line(size = 1) +
  labs(title = "EVD Deaths under Various Intervention Scenarios", 
       x = "Time (days)", y = "Number of Deaths") +
  scale_color_manual(values = custom_colors) +
  theme_minimal() +
  theme(legend.position = "right")

# Display the plot
print(plot1)



```


# Include death values for different scenarios for mu==0.2


```{r}


# Function to run the simulation with psychosocial support intervention
simulate_psychosocial_support <- function(mu) {
  # Adjust tau_Is based on the psychosocial support
  adjusted_tau_Is <- (1 - mu) * base_params["tau_Is"]
  
  # Define a new parameter set with adjusted tau_Is
  parms <- base_params
  parms["tau_Is"] <- adjusted_tau_Is
  
  # Set the mu value for psychosocial support in the parameters
  parms["mu"] <- mu

  # Run the simulation
  simulation <- ode(y = initial_state, times = times, func = EVD_model, parms = parms)
  output <- as.data.frame(simulation)
  colnames(output) <- c("time", "Susceptible", "Exposed", "Quarantined", "Infected", "Isolated", "Recovered", "Dead")
  
  # Add mu value to the output for identification
  output$mu <- mu
  return(output)
}

# Define the simulation function
simulate_model <- function(mu_health = 0, mu_quarantine = 0, mu_isolation = 0, mu_psychosocial = 0) {
  
  # Default adjusted values for the interventions
  adjusted_beta <- base_params["beta"]
  adjusted_rho <- base_params["rho"]
  adjusted_alpha <- base_params["alpha"]
  
  # Apply health education adjustment
  adjusted_beta <- (1 - mu_health) * adjusted_beta
  
  # Apply quarantine adjustment
  if (mu_quarantine > 0) {
    adjusted_beta <- (1 - mu_quarantine * 0.3) * adjusted_beta
    adjusted_rho <- base_params["rho"] * (1 + mu_quarantine * 2)
  }

  # Apply isolation adjustment
  if (mu_isolation > 0) {
    adjusted_beta <- (1 - mu_isolation * 0.5) * adjusted_beta
    adjusted_alpha <- (1 + mu_isolation * 0.5) * adjusted_alpha
  }

  # Apply psychosocial support adjustment
  if (mu_psychosocial > 0) {
    adjusted_tau_Is <- (1 - mu_psychosocial) * base_params["tau_Is"]
  } else {
    adjusted_tau_Is <- base_params["tau_Is"]
  }

  # Define a new parameter set with adjusted values
  parms <- base_params
  parms["beta"] <- adjusted_beta
  parms["rho"] <- adjusted_rho
  parms["alpha"] <- adjusted_alpha
  parms["tau_Is"] <- adjusted_tau_Is
  
  # Run the simulation using the ode solver
  simulation <- ode(y = initial_state, times = times, func = EVD_model, parms = parms)
  
  # Convert the simulation output to a data frame
  output <- as.data.frame(simulation)
  colnames(output) <- c("time", "Susceptible", "Exposed", "Quarantined", "Infected", "Isolated", "Recovered", "Dead")
  
  return(output)
}

# Define the different scenarios
scenarios <- list(
  "No Intervention" = list(mu_health = 0, mu_quarantine = 0, mu_isolation = 0, mu_psychosocial = 0),
  "Health Education Alone" = list(mu_health = 0.2, mu_quarantine = 0, mu_isolation = 0, mu_psychosocial = 0),
  "Timely Quarantine Alone" = list(mu_health = 0, mu_quarantine = 0.2, mu_isolation = 0, mu_psychosocial = 0),
  "Timely Isolation Alone" = list(mu_health = 0, mu_quarantine = 0, mu_isolation = 0.2, mu_psychosocial = 0),
  "Psychosocial Support Alone" = list(mu_health = 0, mu_quarantine = 0, mu_isolation = 0, mu_psychosocial = 0.2),
  "Health Education and Timely Quarantine" = list(mu_health = 0.2, mu_quarantine = 0.2, mu_isolation = 0, mu_psychosocial = 0),
  "Health Education and Timely Isolation" = list(mu_health = 0.2, mu_quarantine = 0, mu_isolation = 0.2, mu_psychosocial = 0),
  "Health Education and Psychosocial Support" = list(mu_health = 0.2, mu_quarantine = 0, mu_isolation = 0, mu_psychosocial = 0.2),
  "Timely Quarantine and Psychosocial Support" = list(mu_health = 0, mu_quarantine = 0.2, mu_isolation = 0, mu_psychosocial = 0.2),
  "Timely Isolation and Psychosocial Support" = list(mu_health = 0, mu_quarantine = 0, mu_isolation = 0.2, mu_psychosocial = 0.2),
  "Timely Quarantine and Timely Isolation" = list(mu_health = 0, mu_quarantine = 0.2, mu_isolation = 0.2, mu_psychosocial = 0),
  "Health Education, Timely Quarantine and Psychosocial Support" = list(mu_health = 0.2, mu_quarantine = 0.2, mu_isolation = 0, mu_psychosocial = 0.2),
  "Health Education, Timely Isolation and Psychosocial Support" = list(mu_health = 0.2, mu_quarantine = 0, mu_isolation = 0.2, mu_psychosocial = 0.2),
  "Timely Quarantine, Timely Isolation and Psychosocial Support" = list(mu_health = 0, mu_quarantine = 0.2, mu_isolation = 0.2, mu_psychosocial = 0.2),
  "Health Education, Timely Quarantine, Timely Isolation and Psychosocial Support" = list(mu_health = 0.2, mu_quarantine = 0.2, mu_isolation = 0.2, mu_psychosocial = 0.2)
)

# Initialize an empty list to store outputs
results_list <- list()

# Loop through each scenario and run the simulation
for (scenario_name in names(scenarios)) {
  scenario <- scenarios[[scenario_name]]
  result <- simulate_model(scenario$mu_health, scenario$mu_quarantine, scenario$mu_isolation, scenario$mu_psychosocial)
  result$scenario <- scenario_name  # Add the scenario name to the result
  results_list[[scenario_name]] <- result
}

# Combine results into one data frame
combined_results <- do.call(rbind, results_list)

# Reshape data for ggplot
combined_results_long <- pivot_longer(combined_results, cols = c(Dead), 
                                      names_to = "Population", values_to = "Count")

# Calculate final number of deaths for each scenario
final_deaths <- combined_results[combined_results$time == max(times), c("scenario", "Dead")]
final_deaths$Deaths <- final_deaths$Dead
final_deaths <- final_deaths[, c("scenario", "Deaths")]

# Update Scenario labels to include final deaths
combined_results$scenario <- factor(combined_results$scenario,
                          levels = unique(combined_results$scenario))

# Define labels with deaths
labels <- sapply(unique(combined_results$scenario), function(scenario) {
  deaths <- final_deaths$Deaths[final_deaths$scenario == scenario]
  paste0(scenario, " (Deaths: ", round(deaths, 0), ")")
})

# Plot results
ggplot(combined_results_long, aes(x = time, y = Count, color = scenario)) +
  geom_line() +
  labs(title = "Effect of Different Interventions on EVD Deaths", x = "Time (days)", y = "Cumulative Deaths") +
  scale_color_manual(values = c("No Intervention" = "black",
                                "Health Education Alone" = "blue",
                                "Timely Quarantine Alone" = "orange",
                                "Timely Isolation Alone" = "red",
                                "Psychosocial Support Alone" = "green",
                                "Health Education and Timely Quarantine" = "purple",
                                "Health Education and Timely Isolation" = "brown",
                                "Health Education and Psychosocial Support" = "pink",
                                "Timely Quarantine and Psychosocial Support" = "cyan",
                                "Timely Isolation and Psychosocial Support" = "yellow",
                                "Timely Quarantine and Timely Isolation" = "violet",
                                "Health Education, Timely Quarantine and Psychosocial Support" = "magenta",
                                "Health Education, Timely Isolation and Psychosocial Support" = "darkgreen",
                                "Timely Quarantine, Timely Isolation and Psychosocial Support" = "darkblue",
                                "Health Education, Timely Quarantine, Timely Isolation and Psychosocial Support" = "darkred"),
                     labels = labels) +
  scale_x_continuous(breaks = seq(0, 100, by = 5)) +
  theme_minimal() +
  theme(legend.position = "right",  # Move legend to the right
        legend.title = element_blank(),
        legend.text = element_text(size = 10),
        axis.title = element_text(size = 12),
        axis.text = element_text(size = 10),
        legend.box = "vertical",  # Ensure a vertical legend layout
        legend.box.margin = margin(0, 0, 0, 0),
        legend.text.align = 0) +
  guides(color = guide_legend(nrow = 20, byrow = TRUE))


```


#########################################################################################################
# Change rates to mu== 0.5

```{r}

# Function to run the simulation with psychosocial support intervention
simulate_psychosocial_support <- function(mu) {
  # Adjust tau_Is based on the psychosocial support
  adjusted_tau_Is <- (1 - mu) * base_params["tau_Is"]
  
  # Define a new parameter set with adjusted tau_Is
  parms <- base_params
  parms["tau_Is"] <- adjusted_tau_Is
  
  # Set the mu value for psychosocial support in the parameters
  parms["mu"] <- mu

  # Run the simulation
  simulation <- ode(y = initial_state, times = times, func = EVD_model, parms = parms)
  output <- as.data.frame(simulation)
  colnames(output) <- c("time", "Susceptible", "Exposed", "Quarantined", "Infected", "Isolated", "Recovered", "Dead")
  
  # Add mu value to the output for identification
  output$mu <- mu
  return(output)
}

# Define the simulation function
simulate_model <- function(mu_health = 0, mu_quarantine = 0, mu_isolation = 0, mu_psychosocial = 0) {
  
  # Default adjusted values for the interventions
  adjusted_beta <- base_params["beta"]
  adjusted_rho <- base_params["rho"]
  adjusted_alpha <- base_params["alpha"]
  
  # Apply health education adjustment
  adjusted_beta <- (1 - mu_health) * adjusted_beta
  
  # Apply quarantine adjustment
  if (mu_quarantine > 0) {
    adjusted_beta <- (1 - mu_quarantine * 0.3) * adjusted_beta
    adjusted_rho <- base_params["rho"] * (1 + mu_quarantine * 2)
  }

  # Apply isolation adjustment
  if (mu_isolation > 0) {
    adjusted_beta <- (1 - mu_isolation * 0.5) * adjusted_beta
    adjusted_alpha <- (1 + mu_isolation * 0.5) * adjusted_alpha
  }

  # Apply psychosocial support adjustment
  if (mu_psychosocial > 0) {
    adjusted_tau_Is <- (1 - mu_psychosocial) * base_params["tau_Is"]
  } else {
    adjusted_tau_Is <- base_params["tau_Is"]
  }

  # Define a new parameter set with adjusted values
  parms <- base_params
  parms["beta"] <- adjusted_beta
  parms["rho"] <- adjusted_rho
  parms["alpha"] <- adjusted_alpha
  parms["tau_Is"] <- adjusted_tau_Is
  
  # Run the simulation using the ode solver
  simulation <- ode(y = initial_state, times = times, func = EVD_model, parms = parms)
  
  # Convert the simulation output to a data frame
  output <- as.data.frame(simulation)
  colnames(output) <- c("time", "Susceptible", "Exposed", "Quarantined", "Infected", "Isolated", "Recovered", "Dead")
  
  return(output)
}

# Define the different scenarios
scenarios <- list(
  "No Intervention" = list(mu_health = 0, mu_quarantine = 0, mu_isolation = 0, mu_psychosocial = 0),
  "Health Education Alone" = list(mu_health = 0.5, mu_quarantine = 0, mu_isolation = 0, mu_psychosocial = 0),
  "Timely Quarantine Alone" = list(mu_health = 0, mu_quarantine = 0.5, mu_isolation = 0, mu_psychosocial = 0),
  "Timely Isolation Alone" = list(mu_health = 0, mu_quarantine = 0, mu_isolation = 0.5, mu_psychosocial = 0),
  "Psychosocial Support Alone" = list(mu_health = 0, mu_quarantine = 0, mu_isolation = 0, mu_psychosocial = 0.5),
  "Health Education and Timely Quarantine" = list(mu_health = 0.5, mu_quarantine = 0.5, mu_isolation = 0, mu_psychosocial = 0),
  "Health Education and Timely Isolation" = list(mu_health = 0.5, mu_quarantine = 0, mu_isolation = 0.5, mu_psychosocial = 0),
  "Health Education and Psychosocial Support" = list(mu_health = 0.5, mu_quarantine = 0, mu_isolation = 0, mu_psychosocial = 0.5),
  "Timely Quarantine and Psychosocial Support" = list(mu_health = 0, mu_quarantine = 0.5, mu_isolation = 0, mu_psychosocial = 0.5),
  "Timely Isolation and Psychosocial Support" = list(mu_health = 0, mu_quarantine = 0, mu_isolation = 0.5, mu_psychosocial = 0.5),
  "Timely Quarantine and Timely Isolation" = list(mu_health = 0, mu_quarantine = 0.5, mu_isolation = 0.5, mu_psychosocial = 0),
  "Health Education, Timely Quarantine and Psychosocial Support" = list(mu_health = 0.5, mu_quarantine = 0.5, mu_isolation = 0, mu_psychosocial = 0.5),
  "Health Education, Timely Isolation and Psychosocial Support" = list(mu_health = 0.5, mu_quarantine = 0, mu_isolation = 0.5, mu_psychosocial = 0.5),
  "Timely Quarantine, Timely Isolation and Psychosocial Support" = list(mu_health = 0, mu_quarantine = 0.5, mu_isolation = 0.5, mu_psychosocial = 0.5),
  "Health Education, Timely Quarantine, Timely Isolation and Psychosocial Support" = list(mu_health = 0.5, mu_quarantine = 0.5, mu_isolation = 0.5, mu_psychosocial = 0.5)
)

# Initialize an empty list to store outputs
results_list <- list()

# Loop through each scenario and run the simulation
for (scenario_name in names(scenarios)) {
  scenario <- scenarios[[scenario_name]]
  result <- simulate_model(scenario$mu_health, scenario$mu_quarantine, scenario$mu_isolation, scenario$mu_psychosocial)
  result$scenario <- scenario_name  # Add the scenario name to the result
  results_list[[scenario_name]] <- result
}

# Combine results into one data frame
combined_results <- do.call(rbind, results_list)

# Reshape data for ggplot
combined_results_long <- pivot_longer(combined_results, cols = c(Dead), 
                                      names_to = "Population", values_to = "Count")

# Calculate final number of deaths for each scenario
final_deaths <- combined_results[combined_results$time == max(times), c("scenario", "Dead")]
final_deaths$Deaths <- final_deaths$Dead
final_deaths <- final_deaths[, c("scenario", "Deaths")]

# Update Scenario labels to include final deaths
combined_results$scenario <- factor(combined_results$scenario,
                          levels = unique(combined_results$scenario))

# Define labels with deaths
labels <- sapply(unique(combined_results$scenario), function(scenario) {
  deaths <- final_deaths$Deaths[final_deaths$scenario == scenario]
  paste0(scenario, " (Deaths: ", round(deaths, 0), ")")
})

# Plot results
ggplot(combined_results_long, aes(x = time, y = Count, color = scenario)) +
  geom_line() +
  labs(title = "Effect of Different Interventions on EVD Deaths", x = "Time (days)", y = "Cumulative Deaths") +
  scale_color_manual(values = c("No Intervention" = "black",
                                "Health Education Alone" = "blue",
                                "Timely Quarantine Alone" = "orange",
                                "Timely Isolation Alone" = "red",
                                "Psychosocial Support Alone" = "green",
                                "Health Education and Timely Quarantine" = "purple",
                                "Health Education and Timely Isolation" = "brown",
                                "Health Education and Psychosocial Support" = "pink",
                                "Timely Quarantine and Psychosocial Support" = "cyan",
                                "Timely Isolation and Psychosocial Support" = "yellow",
                                "Timely Quarantine and Timely Isolation" = "violet",
                                "Health Education, Timely Quarantine and Psychosocial Support" = "magenta",
                                "Health Education, Timely Isolation and Psychosocial Support" = "darkgreen",
                                "Timely Quarantine, Timely Isolation and Psychosocial Support" = "darkblue",
                                "Health Education, Timely Quarantine, Timely Isolation and Psychosocial Support" = "darkred"),
                     labels = labels) +
  scale_x_continuous(breaks = seq(0, 100, by = 5)) +
  theme_minimal() +
  theme(legend.position = "right",  # Move legend to the right
        legend.title = element_blank(),
        legend.text = element_text(size = 10),
        axis.title = element_text(size = 12),
        axis.text = element_text(size = 10),
        legend.box = "vertical",  # Ensure a vertical legend layout
        legend.box.margin = margin(0, 0, 0, 0),
        legend.text.align = 0) +
  guides(color = guide_legend(nrow = 20, byrow = TRUE))




```


















